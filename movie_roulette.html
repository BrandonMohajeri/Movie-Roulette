<!DOCTYPE HTML>
<head></head>
<body style="position: absolute; top: 2%; left: 30%;">
	<div>
		<h3>Pick a random movie to watch from the top 250 movies</h3>
	</div>

	<div style="padding 200px;">
		<button type="button" class="submit" name="submit" style="margin-left: 150px;background: #3399FF; border-radius: 5px; border-color: #3399FF;
"> Choose Movie! </button>
	</div>
	</br>
	<div class="data" style="margin-left: 90px;">
	</div>
</body>
</html>

<script type="text/javascript">
			var submit = document.getElementsByClassName("submit")[0];
			var r;

			submit.addEventListener("click", function(){
			xmlhttp = new XMLHttpRequest();
			var url = "https://www.reddit.com/r/movies/comments/31obue/i_averaged_out_movie_ratings_from_imdb_rotten/.json?raw_json=1"
			httpGet(url);
		});

			function httpGet(theUrl, callback)
			{
			    var xmlHttp = new XMLHttpRequest();
			    var list = [];


			    xmlHttp.onreadystatechange = function() { 
			        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
    							var answer = xmlHttp.responseText;
				   			  var str = JSON.stringify(answer);
				   			  var jsonResponse = JSON.parse(str);
				   			  var array = JSON.parse("[" + jsonResponse + "]");
				   			  var json = array[0][0].data.children[0].data.selftext_html;

							    var el = document.createElement( 'html' );
							    el.innerHTML = json;
								  var item = el.getElementsByTagName( 'li' );

							   for(var i = 0; i < 249; i++){
							   		var movie = item[i].innerHTML;
							   		var split = movie.split("-");
							   		var split2 = split[0];
							   		var movie2 = split2.substring(split2.indexOf('.')+1)

							   		var errorMovies;
							   		if(movie2[0] == "5"){
							   			errorMovies = movie2;
							   			errorMovies = errorMovies.split(".")[1];
							   			//console.log(errorMovies);
							   			list.push(errorMovies);
							   		}
							   		else{
							   			list.push(movie2);
							   		}
							   }
							  x =  Math.floor(Math.random() * (249 - 0 + 1) + 0);
			    			r = list[x];
			    			getImdb(r);
			        }
			    } 
			    xmlHttp.open("GET", theUrl, true);
			    xmlHttp.send(null);
			}

			function getImdb(movieTitle){
				var split = movieTitle.replace(/ /g, "+");
				var url = "http://www.omdbapi.com/?t=" + split + "&y=&plot=short&r=json"
				var xmlHttp = new XMLHttpRequest();
			    xmlHttp.onreadystatechange = function() { 
			        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
    						var answer = xmlHttp.responseText;
    						var json = JSON.parse(answer);
				   			var title = json.Title;
							  var year =  json.Released;
							  var rated = json.Rated;
							  var genre = json.Genre;
							  var director = json.Director;
							  var plot = json.Plot;
							  var rating = json.imdbRating;
							  var actors = json.Actors;
							  var poster = json.Poster;
							 	var data = document.getElementsByClassName("data")[0];

							 	if(json.Response == "False"){
							 		data.innerHTML = "Sorry," + movieTitle + " was not found in our database";
							 	}
							 	else{
							 		data.innerHTML = "Title: " + movieTitle + "<br>" + "Release Date: " + year + "<br>" + "MPAA Rating: " + rated + "<br>"
							  		+ "Genre: " + genre + "<br>" + "Directed by: " + director +  "<br>"  + "Actors: " + actors + "<br>"+ "Plot: " + plot + "<br>" + "Rating: " + rating + "<br>" + "<img src='" + poster + "'>";
							  }					
			    			}
			    		}
			    xmlHttp.open("GET", url, true);
			    xmlHttp.send(null);
	}
	</script>